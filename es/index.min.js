let t=52.35987755982988,e=3.141592653589793,n=6378245,o=.006693421622965943;function r(t,e){let n=52.35987755982988,o=t-.0065,r=e-.006,i=Math.sqrt(o*o+r*r)-2e-5*Math.sin(r*n),a=Math.atan2(r,o)-3e-6*Math.cos(o*n);return[i*Math.cos(a),i*Math.sin(a)]}function i(e,n){let o=Math.sqrt(e*e+n*n)+2e-5*Math.sin(n*t),r=Math.atan2(n,e)+3e-6*Math.cos(e*t);return[o*Math.cos(r)+.0065,o*Math.sin(r)+.006]}function a(t,r){if(p(t,r))return[t,r];{let i=u(t-105,r-35),a=h(t-105,r-35),l=r/180*e,s=Math.sin(l);s=1-o*s*s;let c=Math.sqrt(s);return i=180*i/(n*(1-o)/(s*c)*e),a=180*a/(n/c*Math.cos(l)*e),[t+a,r+i]}}function l(t,e){let n=a(t,e);return i(n[0],n[1])}function s(t,e){let n=r(t,e);return c(n[0],n[1])}function c(t,r){let i,a;if(p(t,r))return[t,r];{let l=u(t-105,r-35),s=h(t-105,r-35),c=r/180*e,p=Math.sin(c);p=1-o*p*p;let d=Math.sqrt(p);return l=180*l/(n*(1-o)/(p*d)*e),s=180*s/(n/d*Math.cos(c)*e),i=r+l,a=t+s,[2*t-a,2*r-i]}}function u(t,n){let o=2*t-100+3*n+.2*n*n+.1*t*n+.2*Math.sqrt(Math.abs(t));return o+=2*(20*Math.sin(6*t*e)+20*Math.sin(2*t*e))/3,o+=2*(20*Math.sin(n*e)+40*Math.sin(n/3*e))/3,o+=2*(160*Math.sin(n/12*e)+320*Math.sin(n*e/30))/3,o}function h(t,n){let o=300+t+2*n+.1*t*t+.1*t*n+.1*Math.sqrt(Math.abs(t));return o+=2*(20*Math.sin(6*t*e)+20*Math.sin(2*t*e))/3,o+=2*(20*Math.sin(t*e)+40*Math.sin(t/3*e))/3,o+=2*(150*Math.sin(t/12*e)+300*Math.sin(t/30*e))/3,o}function p(t,e){return t<72.004||t>137.8347||e<.8293||e>55.8271||!1}function d(t,e,n){return new Promise(((o,r)=>{!function i(a=0){let l=t[a],s=!(!window?.rawWindow?.[e]&&!window?.[e]);n&&(s=n());(function(t,e=!1,n){return new Promise(((o,r)=>{let i=window?.rawWindow?.document||window?.document;try{e&&o(!0);let a=i.createElement("script");a.type="text/javascript",a.readyState?a.onreadystatechange=function(){"loaded"!=a.readyState&&"complete"!=a.readyState||(a.onreadystatechange=null,o(!0))}:(a.onload=function(){n&&!window[n]&&window.rawWindow&&window.rawWindow[n]&&(window[n]=window.rawWindow[n]),o(!0)},a.onerror=function(t){r(t)}),a.src=t,i.head.appendChild(a)}catch(t){r(!1)}}))})(l,s,e).then((()=>{let t=window.rawWindow?.[e]||window?.[e];o(t)})).catch((()=>{a+1>t.length-1?r(!1):i(a+1)}))}()}))}function f(t,e){let n={...t};return Object.keys(e).forEach((o=>{void 0===t[o]&&"object"!=typeof e[o]?n[o]=e[o]:Array.isArray(e[o])&&e[o].length>0&&(!t[o]||0===t[o].length)?n[o]=[...e[o]]:Array.isArray(t[o])?n[o]=[...t[o]]:"object"==typeof e[o]&&null!==e[o]&&(n[o]=f(n[o]||{},e[o]))})),n}class g{constructor(t){return Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=f(t,{position:"topright",menus:[],map:null}),this}init(){let t=this;return new Promise((e=>{window.L.Control.LegendPolygon=window.L.Control.extend({initialize:function(t){window.L.Util.extend(this.options,t)},onAdd:function(){this._container=window.L.DomUtil.create("div","leaflet-control-clegend");let n={};return t.options.menus.map((t=>{let e=document.createElement("div");if(e.innerHTML=t.name,t.attrs)for(const n in t.attrs)e.setAttribute(n,t.attrs[n]);n[t.name]=e,e.addEventListener("click",(n=>(t.onClick(n,e,this._container),n.stopPropagation(),n.preventDefault(),!1))),this._container.appendChild(e)})),e(n),this._container}}),window.L.control.LegendPolygon=function(t){return new window.L.Control.LegendPolygon(t)},window.L.control.LegendPolygon({position:this.options.position}).addTo(this.options.map)}))}}class m{constructor(t){Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pointMarkerList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clickDown",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMove",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.options=t,this.pointMarkerList=[],this.addDefaultPoint(),this.options.map.on("mousedown",(()=>{this.clickDown=!0})),this.options.map.on("mousemove",(()=>{this.isMove=this.clickDown})),this.options.map.on("mouseup",(()=>{this.clickDown=!1})),this.options.map.on("click",(t=>{this.isMove||(this.options.muti&&this.options.maxPoint&&this.pointMarkerList.length>this.options.maxPoint?this.options.onError?.("pointMax","打点数量超过最大值"):(this.options.muti||(this.pointMarkerList.forEach((t=>{t.remove()})),this.pointMarkerList=[]),this.addMarker([t.latlng.lat,t.latlng.lng]),this.onChange()))})),this.initToolBox()}initToolBox(){new g({map:this.options.map,menus:[{name:"删除",attrs:{class:"remove_btn"},onClick:()=>{this.pointMarkerList.forEach((t=>{t.remove()})),this.pointMarkerList=[]}}]}).init()}addMarker(t){let e=window.L.marker(t,{});e.on("click",(()=>{this.pointMarkerList=this.pointMarkerList.filter((t=>t!==e)),e.remove(),this.onChange()})),e.addTo(this.options.map),this.pointMarkerList.push(e)}onChange(){let t=[];this.pointMarkerList.forEach((e=>{let n=[e._latlng.lng,e._latlng.lat];if("wgs84"!==this.options.crs)switch(this.options.crs){case"gcj02":n=c(e._latlng.lng,e._latlng.lat);break;case"bd09":n=s(e._latlng.lng,e._latlng.lat)}t.push(n)})),this.options.onChange?.(t)}addDefaultPoint(){this.options.value?.forEach?.((t=>{let e=t;if("wgs84"!==this.options.crs)switch(this.options.crs){case"gcj02":e=a(t[0],t[1]);break;case"bd09":e=l(t[0],t[1])}this.addMarker(e.reverse())}))}}function y(t,e=1){if(t?.startsWith("#"))return((t,e=1)=>{let n=t.slice(1);return"rgba("+[parseInt("0x"+n.slice(0,2)),parseInt("0x"+n.slice(2,4)),parseInt("0x"+n.slice(4,6)),e].toString()+")"})(t,e);if(t?.startsWith("rgb")&&!t?.startsWith("rgba"))return t.replace("rgb","rgba").replace(")",`,${e})`);const n=/rgba\((.+)\)/.exec(t);if(n){const t=n[1].split(",");return`rgba(${t[0]},${t[1]},${t[2]},${e})`}return t.replace(/,\d\)/,`,${e})`)}var b,v={exports:{}};self,b=()=>(()=>{var t={785:(t,e,n)=>{n.d(e,{Z:()=>r}),e=n(327),e=n.n(e);var o=n(632);(n=n.n(o)()(e())).push([t.id," \r\n:root {\r\n  --border-style: 1px solid #666;\r\n  --bottom-height: 22px;\r\n  --hue-slider-width: 12px;\r\n  --margin-size: 6px;\r\n}\r\n\r\n/* 最外层容器 */\r\n.zengsg-color-picker-container {\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: var(--margin-size);\r\n}\r\n.zengsg-color-picker-container,\r\n.zengsg-color-picker-container * {\r\n  box-sizing: border-box;\r\n}\r\n/* 颜色画板 */\r\n.zengsg-color-picker-content {\r\n  position: relative;\r\n  width: 100%;\r\n  height: calc(100% - var(--bottom-height) - var(--margin-size));\r\n  padding-right: calc(var(--hue-slider-width) + var(--margin-size));\r\n}\r\n.zengsg-color-picker-content .zengsg-svpanel {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(255, 0, 0, 1);\r\n}\r\n.zengsg-color-picker-content .zengsg-svpanel .zengsg-svpanel-white,\r\n.zengsg-color-picker-content .zengsg-svpanel .zengsg-svpanel-black {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n.zengsg-color-picker-content .zengsg-svpanel .zengsg-svpanel-white {\r\n  background: linear-gradient(to right, #fff, rgba(255, 255, 255, 0));\r\n}\r\n.zengsg-color-picker-content .zengsg-svpanel .zengsg-svpanel-black {\r\n  background: linear-gradient(to top, #000, rgba(0, 0, 0, 0));\r\n}\r\n.zengsg-color-picker-content .zengsg-svpanel .zengsg-svpanel-dot {\r\n  --size:6px;\r\n  position: absolute;\r\n  width: var(--size);\r\n  height: var(--size);\r\n  border: 1px solid #666;\r\n  /* background: #ddd; */\r\n  left: calc(100% - var(--size));\r\n  top: 0px;\r\n  border-radius: 50%;\r\n\r\n  cursor: pointer;\r\n}\r\n\r\n.zengsg-color-picker-content .zengsg-hue-slider {\r\n  position: absolute;\r\n  right: 0;\r\n  background-color: rgba(255, 0, 0, 1);\r\n}\r\n.zengsg-color-picker-content .zengsg-hue-slider.is-vertical {\r\n  width: var(--hue-slider-width);\r\n  height: 100%;\r\n  padding: 2px 0;\r\n  top: 0;\r\n}\r\n.zengsg-color-picker-content .zengsg-hue-slider .zengsg-hue-slider-bar {\r\n  position: relative;\r\n  background: linear-gradient(\r\n    to bottom,\r\n    #f00 0%,\r\n    #ff0 17%,\r\n    #0f0 33%,\r\n    #0ff 50%,\r\n    #00f 67%,\r\n    #f0f 83%,\r\n    #f00 100%\r\n  );\r\n  height: 100%;\r\n}\r\n.zengsg-color-picker-content .zengsg-hue-slider .zengsg-hue-slider-thumb {\r\n  position: absolute;\r\n  cursor: pointer;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 4px;\r\n  background: #fff;\r\n  box-shadow: 0 0 2px #0009;\r\n  z-index: 1;\r\n  left: 0;\r\n  top: 0;\r\n  left: 0;\r\n}\r\n\r\n/* 底部内容 */\r\n.zengsg-color-picker-bottom {\r\n  height: var(--bottom-height);\r\n  display: flex;\r\n  align-items: center;\r\n  /* background: salmon; */\r\n  margin-top: var(--margin-size);\r\n}\r\n\r\n.zengsg-color-picker-bottom .color {\r\n  display: block;\r\n  width: var(--bottom-height);\r\n  height: var(--bottom-height);\r\n  margin-right: var(--margin-size);\r\n  border: var(--border-style);\r\n}\r\n\r\n.zengsg-color-picker-bottom .zengsg-color-input {\r\n  background: none;\r\n  outline: none;\r\n  border: var(--border-style);\r\n  height: var(--bottom-height);\r\n  line-height: var(--bottom-height);\r\n  border-radius: 2px;\r\n  padding-left: var(--margin-size);\r\n  padding-right: var(--margin-size);\r\n  font-size: 14px;\r\n  color: #333;\r\n}\r\n.zengsg-color-picker-bottom .zengsg-color-input :focus {\r\n  outline: none;\r\n}\r\n",""]);const r=n},632:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",o=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),o&&(n+="@layer".concat(0<e[5].length?" ".concat(e[5]):""," {")),n+=t(e),o&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,o,r,i){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(o)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(a[s]=!0)}for(var c=0;c<t.length;c++){var u=[].concat(t[c]);o&&a[u[0]]||(void 0!==i&&(void 0!==u[5]&&(u[1]="@layer".concat(0<u[5].length?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]&&(u[1]="@media ".concat(u[2]," {").concat(u[1],"}")),u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),e.push(u))}},e}},327:t=>{t.exports=function(t){return t[1]}},480:t=>{var e=[];function n(t){for(var n=-1,o=0;o<e.length;o++)if(e[o].identifier===t){n=o;break}return n}function o(t,o){for(var r={},i=[],a=0;a<t.length;a++){var l=t[a],s=r[u=o.base?l[0]+o.base:l[0]]||0,c="".concat(u," ").concat(s),u=(r[u]=s+1,n(c));s={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]},-1!==u?(e[u].references++,e[u].updater(s)):(l=function(t,e){var n=e.domAPI(e);return n.update(t),function(e){e?e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer||n.update(t=e):n.remove()}}(s,o),o.byIndex=a,e.splice(a,0,{identifier:c,updater:l,references:1})),i.push(c)}return i}t.exports=function(t,r){var i=o(t=t||[],r=r||{});return function(t){t=t||[];for(var a=0;a<i.length;a++){var l=n(i[a]);e[l].references--}t=o(t,r);for(var s=0;s<i.length;s++){var c=n(i[s]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}i=t}}},308:t=>{var e={};t.exports=function(t,n){if(!(t=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t)))throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(n)}},969:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},442:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},391:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){var o,r,i,a;o=e,r=t,i="",n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {")),(a=void 0!==n.layer)&&(i+="@layer".concat(0<n.layer.length?" ".concat(n.layer):""," {")),i+=n.css,a&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}"),(a=n.sourceMap)&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),r.styleTagTransform(i,o,r.options)},remove:function(){var t;null!==(t=e).parentNode&&t.parentNode.removeChild(t)}}}},14:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(o){var r=e[o];return void 0!==r||(r=e[o]={id:o,exports:{}},t[o](r,r.exports,n)),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nc=void 0;var o,r,i,a,l,s,c,u,h,p,d,f,g,m,y,b={};function v(){var t="ipad"==(l=navigator.userAgent.toLowerCase()).match(/ipad/i),e="iphone os"==l.match(/iphone os/i),n="midp"==l.match(/midp/i),o="rv:1.2.3.4"==l.match(/rv:1.2.3.4/i),r="ucweb"==l.match(/ucweb/i),i="android"==l.match(/android/i),a="windows ce"==l.match(/windows ce/i),l="windows mobile"==l.match(/windows mobile/i);return t||e||n||o||r||i||a||l}function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,function(t){return t=function(t,e){if("object"!==w(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return String(t);if("object"!==w(n=n.call(t,"string")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),"symbol"===w(t)?t:String(t)}(o.key),o)}}function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function L(t){t/=60;var e=255*(1-Math.abs(t%2-1)),n=0,o=0,r=0;return 0<=t&&t<1?(n=255,o=e):1<=t&&t<2?(n=e,o=255):r=2<=t&&t<3?(o=255,e):3<=t&&t<4?(o=e,255):4<=t&&t<5?(n=e,255):(n=255,e),[n+=0,o+=0,r+=0]}function E(t,e,n){t/=255,e/=255,n/=255;var o,r=Math.max(t,e,n),i=Math.min(t,e,n),a=r,l=r-i,s=0==r?0:l/r;if(r==i)o=0;else{switch(r){case t:o=(e-n)/l+(e<n?6:0);break;case e:o=(n-t)/l+2;break;case n:o=(t-e)/l+4}o/=6}return{h:360*o,s:100*s,v:100*a}}function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t){return function(t){if(Array.isArray(t))return T(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var n;if(t)return"string"==typeof t?T(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function O(t){return t=function(t,e){if("object"!==j(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return String(t);if("object"!==j(n=n.call(t,"string")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),"symbol"===j(t)?t:String(t)}return n.r(b),n.d(b,{ColorPicker:()=>y}),o="INPUT",r={HEX:"hex",RGB:"rgb"},i=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var e,n;return e=t,(n=[{key:"move",get:function(){return v()?"touchmove":"mousemove"}},{key:"down",get:function(){return v()?"touchstart":"mousedown"}},{key:"up",get:function(){return v()?"touchend":"mouseup"}}])&&k(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),a=function(){function t(e){var n=e.container,o=e.hsv;if(e=e.callback,!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.container=n,this.dotParam={},this.sliderParam={},this.updateColorCallabck=e,this._hue=o[0],this._init()}var e,n;return e=t,(n=[{key:"_init",value:function(){this._initParams(),this._initEvent()}},{key:"_initParams",value:function(){this.sliderParam.el=document.querySelector(".zengsg-hue-slider");var t=this.sliderParam.el.getBoundingClientRect();this.sliderParam.height=t.height,this.sliderParam.top=t.top,this.dotParam.el=document.querySelector(".zengsg-hue-slider-thumb"),t=this.dotParam.el.getBoundingClientRect(),this.dotParam.height=t.height,this.dotParam.top=t.top,this._updateDotPosition(this._hue/360*this.sliderParam.height)}},{key:"_initEvent",value:function(){this.sliderParam.el.addEventListener(i.down,this._mouseDown.bind(this))}},{key:"_mouseDown",value:function(t){this._update(t),this._removeEvent(),this._removeEventThat=this._removeEvent.bind(this),this._updateThat=this._update.bind(this),window.addEventListener(i.up,this._removeEventThat),window.addEventListener(i.move,this._updateThat)}},{key:"_removeEvent",value:function(){window.removeEventListener(i.move,this._updateThat),window.removeEventListener(i.up,this._removeEventThat),this._updateThat=null,this._removeEventThat=null}},{key:"_update",value:function(t){var e=-1,n=(v()?e=t.targetTouches[0].clientY:(e=t.y,t.preventDefault&&t.preventDefault()),t=this.sliderParam).top;t=t.height,e-=n,this._updateDotPosition(e=t<(e=e<0?0:e)?t:e),this._updateColor(e)}},{key:"_updateDotPosition",value:function(t){var e=(n=this.dotParam).el,n=n.height;e.style.top=t-n/2+"px"}},{key:"_updateColor",value:function(t){var e=this.sliderParam.height,n=this.dotParam.height;t-=n/2,this._hue=Math.round((0<t?t:0)/(e-n/2)*360),this.updateColorCallabck&&this.updateColorCallabck("HUE")}},{key:"hue",get:function(){return this._hue},set:function(t){this._hue=t,this._updateDotPosition(this._hue/360*this.sliderParam.height)}}])&&function(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,function(t){return t=function(t,e){if("object"!==S(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return String(t);if("object"!==S(n=n.call(t,"string")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),"symbol"===S(t)?t:String(t)}(o.key),o)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),l=function(){function t(e){var n=e.container,o=e.backgroundColor,r=e.callback;if(e=e.hsv,!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.container=n,this.dotParam={},this.panelParam={},this._saturation=e[1],this._value=e[2],this._backgroundColor=o,this.updateColorCallabck=r,this._init()}var e,n;return e=t,(n=[{key:"_init",value:function(){this._initParams(),this._initEvent()}},{key:"_initParams",value:function(){this.dotParam.el=this.container.querySelector(".zengsg-svpanel-dot");var t=this.dotParam.el.getBoundingClientRect();this.dotParam.width=t.width,this.dotParam.height=t.height,this.panelParam.el=this.container.querySelector(".zengsg-svpanel"),t=this.panelParam.el.getBoundingClientRect(),this.panelParam.width=t.width,this.panelParam.height=t.height,this.panelParam.left=t.left,this.panelParam.top=t.top,this._updateBackgroundColor(),this._updateDotPosition()}},{key:"_initEvent",value:function(){this.panelParam.el.addEventListener(i.down,this._mouseDown.bind(this))}},{key:"_mouseDown",value:function(t){this._update(t),this._removeEvent(),this._removeEventThat=this._removeEvent.bind(this),this._updateThat=this._update.bind(this),window.addEventListener(i.up,this._removeEventThat),window.addEventListener(i.move,this._updateThat)}},{key:"_removeEvent",value:function(){window.removeEventListener(i.move,this._updateThat),window.removeEventListener(i.up,this._removeEventThat),this._updateThat=null,this._removeEventThat=null}},{key:"_update",value:function(t){var e,n=-1;v()?(e=t.targetTouches[0].clientY,n=t.targetTouches[0].clientX):(e=t.y,n=t.x,t.preventDefault&&t.preventDefault()),this._updateColor(n,e),this._updateDotPosition()}},{key:"_updateDotPosition",value:function(){var t=this._saturation/100*this.panelParam.width,e=this.panelParam.height-this._value/100*this.panelParam.height,n=(r=this.dotParam).el,o=r.width,r=r.height;n.style.left=t-o/2+"px",n.style.top=e-r/2+"px"}},{key:"_updateColor",value:function(t,e){var n,o=(n=this.panelParam).left,r=n.top,i=n.width;t-=o,(n=n.height)<(o=(o=e-r)<0?0:o)&&(o=n),this._saturation=(t=i<(t=t<0?0:t)?i:t)/i*100,this._value=100-o/n*100,this.updateColorCallabck&&this.updateColorCallabck("SV")}},{key:"_updateBackgroundColor",value:function(){var t=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=i.call(n)).done)&&(l.push(o.value),l.length!==e);s=!0);}catch(t){c=!0,r=t}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return l}}(t,e)||function(t,e){var n;if(t)return"string"==typeof t?C(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this._backgroundColor,3),e=t[0],n=t[1];t=t[2],this.panelParam.el.style.backgroundColor="rgb(".concat(e,",").concat(n,",").concat(t,")")}},{key:"backgroundColor",set:function(t){this._backgroundColor=t,this._updateBackgroundColor()}},{key:"saturation",get:function(){return this._saturation},set:function(t){this._saturation=t,this._updateDotPosition()}},{key:"value",get:function(){return this._value},set:function(t){this._value=t,this._updateDotPosition()}}])&&function(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,function(t){return t=function(t,e){if("object"!==_(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return String(t);if("object"!==_(n=n.call(t,"string")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),"symbol"===_(t)?t:String(t)}(o.key),o)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),s=function(){function t(e){var n=e.container,o=e.rgb,r=e.callback;if(e=e.mode,!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.container=n,this._currentColorRgbArray=o,this.updateColorCallabck=r,this._inputEl=null,this._colorEl=null,this._mode=e,this._init()}var e,n;return e=t,(n=[{key:"_init",value:function(){var t=this;this._inputEl=this.container.querySelector(".zengsg-color-input"),this._colorEl=this.container.querySelector(".color"),this._inputEl.addEventListener("keydown",(function(e){13==e.keyCode&&t._inputChange()})),this._inputEl.addEventListener("blur",this._inputChange.bind(this)),this._updateInputVue()}},{key:"_inputChange",value:function(){var t,e,n=this._inputEl.value,i="string"==typeof(t=n)&&null!=(t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))&&(i=(t=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=i.call(n)).done)&&(l.push(o.value),l.length!==e);s=!0);}catch(t){c=!0,r=t}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return l}}(t,e)||function(t,e){var n;if(t)return"string"==typeof t?P(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(t,e):void 0}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,4))[1],e=t[2],t=t[3],[parseInt(i,10),parseInt(e,10),parseInt(t,10)]);(i=this._mode==r.HEX?"#"===(e=n).charAt(0)&&(4===e.length||7===e.length)&&(4===e.length&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!/^#[0-9A-F]{6}$/i.test(e))&&(e=e.replace("#",""),[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]):i)?this._currentColorRgbArray=i:i=this._currentColorRgbArray,this._updateInputVue(),i&&this.updateColorCallabck&&this.updateColorCallabck(o)}},{key:"_updateInputVue",value:function(){var t,e,n,o=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,l=[],s=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=i.call(n)).done)&&(l.push(o.value),l.length!==e);s=!0);}catch(t){c=!0,r=t}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw r}}return l}}(t,e)||function(t,e){var n;if(t)return"string"==typeof t?M(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(t,e):void 0}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this._currentColorRgbArray,3),i=o[0],a=o[1],l=(o=o[2],this._mode===r.HEX?(e=a,n=o,t=(t=i).toString(16).padStart(2,"0"),e=e.toString(16).padStart(2,"0"),n=n.toString(16).padStart(2,"0"),"#".concat(t).concat(e).concat(n).toUpperCase()):"rgb(".concat(i,",").concat(a,",").concat(o,")"));this._inputEl.value=l,this._colorEl.style.backgroundColor=l}},{key:"currentColorRgbArray",get:function(){return this._currentColorRgbArray},set:function(t){this._currentColorRgbArray=t,this._updateInputVue()}},{key:"inputValue",get:function(){return this._inputEl.value}}])&&function(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,function(t){return t=function(t,e){if("object"!==x(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return String(t);if("object"!==x(n=n.call(t,"string")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),"symbol"===x(t)?t:String(t)}(o.key),o)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),c=n(480),c=n.n(c),u=n(391),u=n.n(u),h=n(308),h=n.n(h),p=n(442),p=n.n(p),d=n(969),d=n.n(d),f=n(14),f=n.n(f),g=n(785),(m={}).styleTagTransform=f(),m.setAttributes=p(),m.insert=h().bind(null,"head"),m.domAPI=u(),m.insertStyleElement=d(),c()(g.Z,m),g.Z&&g.Z.locals&&g.Z.locals,f=y=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.container=e.container||document.querySelector("body"),this._mode=e.mode||r.RGB,this._svPanelInstance=null,this._hueSliderInstance=null,this._bottomInputInstance=null,this._userDefaultColor=e.defaultColor||[0,0,0],this._update=e.update,this._init()}var e,n;return e=t,(n=[{key:"_init",value:function(){this._initTemplate();var t=(n=E.apply(void 0,z(this._userDefaultColor))).h,e=n.s,n=n.v,o=L(t),r=this.updateColorCallback.bind(this);t={container:this.container,rgb:this._userDefaultColor,hsv:[t,e,n],backgroundColor:o,callback:r,mode:this._mode},this._svPanelInstance=new l(t),this._hueSliderInstance=new a(t),this._bottomInputInstance=new s(t)}},{key:"_initTemplate",value:function(){this.container.innerHTML='<div class="zengsg-color-picker-container">\n     <div class="zengsg-color-picker-content">\n       <div class="zengsg-svpanel">\n         <div class="zengsg-svpanel-white"></div>\n         <div class="zengsg-svpanel-black"></div>\n         <div class="zengsg-svpanel-dot"></div>\n       </div>\n       <div class="zengsg-hue-slider is-vertical">\n         <div class="zengsg-hue-slider-bar"></div>\n         <div class="zengsg-hue-slider-thumb"></div>\n       </div>\n     </div>\n     <div class="zengsg-color-picker-bottom">\n       <span class="color"></span>\n       <input type="text" class="zengsg-color-input" />\n     </div>\n   </div>'}},{key:"updateColorCallback",value:function(t){var e,n,r,i,a,l,s;t!==o?(e=this._hueSliderInstance.hue,r=(i=this._svPanelInstance).saturation,i=i.value,this._bottomInputInstance.currentColorRgbArray=(n=e,n%=360,a=(r=(i/=100)*(r/=100))*(1-Math.abs(n/60%2-1)),n=0<=n&&n<60?(l=r,s=a,0):60<=n&&n<120?(l=a,s=r,0):120<=n&&n<180?(l=0,s=r,a):180<=n&&n<240?(l=0,s=a,r):240<=n&&n<300?(l=a,s=0,r):(l=r,s=0,a),l=255*(l+(i-=r)),s=255*(s+i),n=255*(n+i),[Math.round(l),Math.round(s),Math.round(n)]),"HUE"==t&&(this._svPanelInstance.backgroundColor=L(e))):(a=this._bottomInputInstance.currentColorRgbArray,i=(r=E.apply(void 0,z(a))).h,l=r.s,s=r.v,this._svPanelInstance.backgroundColor=L(i),this._svPanelInstance.saturation=l,this._svPanelInstance.value=s,this._hueSliderInstance.hue=i),this._update&&this._update(this._bottomInputInstance.inputValue)}}])&&function(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,O(o.key),o)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),p=r,(h=O(h="INPUT_TEXT_MODE_TYPE"))in f?Object.defineProperty(f,h,{value:p,enumerable:!0,configurable:!0,writable:!0}):f[h]=p,b})();var w=v.exports=b();class k{constructor(t,e=1,n){Object.defineProperty(this,"opacity",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"fullColor",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.onChange=n,this.opacity=e,this.color=t,this.initStyle(),this.initModal(),this.initColorPicker()}initColorPicker(){const t=/rgba\((.+)\)/.exec(y(this.color));let e=[];if(t){e=t[1].split(",").slice(0,3).map((t=>+t))}new w.ColorPicker({container:document.querySelector(".leaflet-color-modal .leaflet-color-modal-content .color-picker-content"),mode:w.ColorPicker.INPUT_TEXT_MODE_TYPE.RGB,defaultColor:e,update:t=>{this.color=t,this.change()}});let n=document.createElement("div");n.classList.add("opacity-div");let o=document.createElement("span");o.textContent="透明度: ";let r=document.createElement("input");r.setAttribute("min","0"),r.setAttribute("max","1"),r.setAttribute("step","0.1"),r.setAttribute("type","range"),r.setAttribute("value",this.opacity+"");let i=document.createElement("span");i.textContent=this.opacity+"",n.append(o,r,i),document.querySelector(".leaflet-color-modal .zengsg-color-picker-bottom")?.appendChild(n),r.addEventListener("input",(t=>{i.textContent=t.target.value,this.opacity=+t.target.value,this.change()}))}change(){let t=y(this.color,this.opacity);this.fullColor=t,document.querySelector(".leaflet-color-modal-content").style.backgroundColor=t}close(){document.querySelector(".leaflet-color-modal")?.remove()}ok(){this.onChange(this.fullColor,+this.opacity),this.close()}initModal(){let t=this;document.querySelector(".leaflet-color-modal")&&document.querySelector(".leaflet-color-modal")?.remove();let e=document.createElement("div");e.classList.add("leaflet-color-modal"),function(){let n=document.createElement("div");n.classList.add("leaflet-color-modal-content"),n.style.backgroundColor=t.color;let o=document.createElement("div");o.classList.add("color-picker-content"),n.appendChild(o),n.appendChild(function(){let e=document.createElement("div");e.textContent="确定";let n=document.createElement("div");n.textContent="取消";let o=document.createElement("div");return o.append(n,e),o.classList.add("leaflet-color-modal-footer"),e.addEventListener("click",t.ok.bind(t)),n.addEventListener("click",t.close.bind(t)),o}()),e.appendChild(n)}(),document.body.appendChild(e)}initStyle(){if("1"===getComputedStyle(document.documentElement).getPropertyValue("--leaflet-draw-color-picker"))return;let t=document.createElement("style");t.type="text/css",t.innerHTML="\n        :root{\n          --leaflet-draw-color-picker:1;\n        }\n        .leaflet-color-modal {\n          position:fixed;\n          width: 100vw;\n          height:100vh;\n          background:rgba(0,0,0,.25);\n          top:0;\n          left:0;\n          z-index:1000;\n        }\n        \n        .leaflet-color-modal .leaflet-color-modal-content {\n          position:absolute;\n          top:50%;\n          left:50%;\n          transform:translate(-50%,-50%);\n          background:white;\n          border-radius:5px;\n          padding:10px;\n        }\n        .leaflet-color-modal .leaflet-color-modal-content .color-picker-content{\n           width: 500px;\n           height: 300px;\n        }\n        .leaflet-color-modal .leaflet-color-modal-content .color-picker-content .zengsg-color-input {\n          pointer-events:none;\n        }\n        \n        .leaflet-color-modal .leaflet-color-modal-content .color-picker-content .opacity-div {\n            margin-left: 10px;\n        }\n        .leaflet-color-modal .leaflet-color-modal-content .color-picker-content .opacity-div input {\n          outline:none;\n        }\n        \n        .leaflet-color-modal .leaflet-color-modal-content .leaflet-color-modal-footer {\n          display:flex;\n          justify-content: flex-end;\n          margin-top: 10px;\n         \n        }\n        .leaflet-color-modal .leaflet-color-modal-content .leaflet-color-modal-footer div {\n          padding: 5px 10px;\n          border-radius: 5px;\n          cursor: pointer;\n          margin-left: 10px;\n          background: white;\n          color:#000;\n          border: 1px solid #000;\n        }\n        .leaflet-color-modal .leaflet-color-modal-content .leaflet-color-modal-footer div:last-child {\n          background: #00a8ff;\n          color:white;\n          border-color:#00a8ff;\n        }\n    ",document.head.appendChild(t)}}class S{constructor(t){Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"points",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"lines",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"tempLines",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"polygonSelect",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"facelines",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"facetempLines",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"facepolygonList",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"markers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"hoverMarker",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"polygonStyle",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"lineStyle",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"isClickPolygon",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"toolBoxDom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=f(t,{max:1,crs:"wgs84"}),this.initStyle(),t.value&&this.initDefaultValue(),this.createControl()}initDefaultValue(){const t=this;this.initStyle();let{features:e}=this.options.value;function n(){t.lineStyle=f(t.lineStyle,{color:"rgb(252, 106, 0)",opacity:1,type:"solid",width:2}),t.polygonStyle=f(t.polygonStyle||{},{color:"rgb(252, 106, 0)",opacity:1})}e.map((t=>{let e=t.geometry,o=e?.coordinates;this.points=[],o.forEach((e=>{e.forEach((t=>{let e=t.reverse();switch(this.options.crs){case"wgs84":break;case"gcj02":e=c(e[0],e[1]);break;case"bd09":e=s(e[0],e[1])}this.points.push(e)})),t.properties&&(t.properties["fill-color"]&&(this.polygonStyle.color=t.properties["fill-color"]),t.properties["fill-opacity"]&&(this.polygonStyle.opacity=t.properties["fill-opacity"]),t.properties["line-color"]&&(this.lineStyle.color=t.properties["line-color"]),t.properties["line-opacity"]&&(this.lineStyle.opacity=t.properties["line-opacity"]),t.properties["line-width"]&&(this.lineStyle.width=t.properties["line-width"]),n())})),this.endDraw()})),n()}initStyle(){this.lineStyle=f(this.options.style?.lineStyle||{},{color:"rgb(252, 106, 0)",opacity:1,type:"solid",width:2}),this.polygonStyle=f(this.options.style?.polygonStyle||{},{color:"rgb(252, 106, 0)",opacity:1})}createFace(){let{hoverMarker:t,options:e}=this;function n(n){let o=document.createElement("div"),r=window.L.divIcon({html:o,className:"polygon_icon",iconSize:[12,12]}),i=window.L.marker(n,{icon:r});return i.on("mousemove",(()=>{t=i})),i.on("mouseout",(()=>{t=null})),i.addTo(e.map),i}this.lines=window.L.polyline([],{color:y(this.lineStyle.color,1)}),this.tempLines=window.L.polyline([],{color:y(this.lineStyle.color,1)}),this.options.map?.addLayer(this.lines),this.options.map?.addLayer(this.tempLines),this.options.map?.on("click",(e=>{if(this.isClickPolygon)return;if(t)return this.points.push([t.getLatLng().lat,t.getLatLng().lng]),this.lines.addLatLng(t.getLatLng()),this.options.map?.addLayer(this.lines),this.facelines.push(this.lines),void this.endDraw();this.facepolygonList.map((t=>{t.setStyle({dashArray:[]})})),this.points.push([e.latlng.lat,e.latlng.lng]),this.lines.addLatLng(e.latlng),this.options.map?.addLayer(this.lines),this.facelines.push(this.lines);let o=n.call(this,e.latlng);this.markers.push(o)})),this.options.map?.on("mousemove",(t=>{this.points.length>0&&(this.tempLines.setLatLngs([this.points[this.points.length-1],[t.latlng.lat,t.latlng.lng]]),this.options.map?.addLayer(this.tempLines),this.facetempLines.push(this.tempLines))})),this.options.map?.on("dblclick",(()=>{this.endDraw()}))}endDraw(){this.toolBoxDom?.["绘制"]?.classList.remove("active"),this.options.map?.off("click");let t=window.L.polygon([this.points],{color:y(this.lineStyle.color,1),opacity:this.lineStyle.opacity,weight:this.lineStyle.width,fillColor:y(this.polygonStyle.color,1),fillOpacity:this.polygonStyle.opacity});t?.addTo?.(this.options.map),this.options.map?.addLayer(t),this.facepolygonList.push(t),this.points=[],this.tempLines?.setLatLngs?.([]),this.lines?.setLatLngs?.([]),this.markers.map((t=>{t?.removeFrom(this.options.map)})),this.polygonSelect=t,this.endDrawChange(),t.on("click",(e=>{this.isClickPolygon=!0,setTimeout((()=>{this.isClickPolygon=!1}),50),this.polygonSelect=t,this.facepolygonList.map((t=>{t.setStyle({dashArray:[]})})),this.polygonSelect.setStyle({dashArray:[2,5]}),this.lineStyle.color=t.options.color,this.lineStyle.opacity=t.options.opacity,this.polygonStyle.opacity=t.options.fillOpacity,this.polygonStyle.color=t.options.fillColor,this.toolBoxDom["线条颜色"]?.setAttribute("style",`color: ${y(this.lineStyle.color,this.lineStyle.opacity)}`),this.toolBoxDom["区域颜色"]?.setAttribute("style",`color: ${y(this.polygonStyle.color,this.polygonStyle.opacity)}`),e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()}))}endDrawChange(){if(0===this.facepolygonList?.length)return;let t=this.featureTransform({type:"FeatureCollection",features:this.createPrototype()});this.options.onChange?.(t)}createPrototype(){return this.facepolygonList.map((t=>{let e=t.options,n=t.toGeoJSON();n.properties={...n.properties,"fill-color":e.fillColor,"fill-opacity":e.fillOpacity,"line-color":e.color,"line-opacity":e.opacity,"line-width":e.weight,center:{}};let o=t.getCenter(),u=[o.lng,o.lat],h={wgs84:[],bd09:[],gcj02:[],zoom:this.options.map?.getZoom()};switch(this.options.crs){case"wgs84":h.wgs84=u,h.bd09=l(u[0],u[1]),h.gcj02=a(u[0],u[1]);break;case"bd09":h.wgs84=s(u[0],u[1]),h.bd09=u,h.gcj02=r(u[0],u[1]);break;case"gcj02":h.wgs84=c(u[0],u[1]),h.bd09=i(u[0],u[1]),h.gcj02=u}return n.properties.center=JSON.stringify(h),n}))}featureTransform(t){return"wgs84"===this.options.crs||(t.features=t.features.map((t=>(t.geometry.coordinates=t.geometry.coordinates.map((t=>t=t.map((t=>{switch(this.options.crs){case"gcj02":return a(t[0],t[1]);case"bd09":return l(t[0],t[1])}return t})))),t)))),t}removePolygon(){this.points.forEach((t=>{this.options.map?.removeLayer(t)})),this.facelines.forEach((t=>{this.options.map?.removeLayer(t)})),this.facetempLines.forEach((t=>{this.options.map?.removeLayer(t)})),this.markers.forEach((t=>{t?.removeFrom(this.options.map)})),this.points=[],this.facelines=[],this.facetempLines=[],this.markers=[];let t=0;this.facepolygonList.map(((e,n)=>{e._leaflet_id===this.polygonSelect?._leaflet_id&&(this.options.map?.removeLayer(e),this.polygonSelect=void 0,t=n)})),this.facepolygonList.splice(t,1)}createControl(){new g({map:this.options.map,menus:[{name:"区域颜色",attrs:{class:"polygon_color_btn",style:`color: ${this.polygonStyle.color}`},onClick:(t,e)=>{new k(this.polygonStyle.color,this.polygonStyle.opacity,((t,n)=>{this.polygonStyle.color=y(t,n),e.style.color=y(t,n),this.polygonStyle.opacity=n,this.polygonSelect?.setStyle({color:this.lineStyle.color,opacity:this.lineStyle.opacity,weight:this.lineStyle.width,fillColor:y(this.polygonStyle.color,1),fillOpacity:this.polygonStyle.opacity}),this.endDrawChange()}))}},{name:"线条颜色",attrs:{class:"line_color_btn",style:`color: ${this.lineStyle.color}`},onClick:(t,e)=>{new k(this.lineStyle.color,this.lineStyle.opacity,((t,n)=>{this.lineStyle.color=y(t,n),e.style.color=y(t,n),this.lineStyle.opacity=n,this.polygonSelect?.setStyle({color:this.lineStyle.color,opacity:this.lineStyle.opacity,weight:this.lineStyle.width,fillColor:y(this.polygonStyle.color,1),fillOpacity:this.polygonStyle.opacity}),this.endDrawChange()}))}},{name:"绘制",attrs:{class:"draw_start_btn"},onClick:(t,e)=>{this.facepolygonList?.length>=this.options.max?this.options?.onError?.("pointMax","超过最大绘制数量"):e.classList.contains("active")?this.options?.onError?.("message","超过最大绘制数量"):(e.classList.add("active"),this.createFace())}},{name:"删除",attrs:{class:"remove_btn"},onClick:(t,e,n)=>{this.removePolygon(),this.endDrawChange(),n.querySelector(".draw_start_btn")?.classList.remove("active")}}]}).init().then((t=>{this.toolBoxDom=t}))}}class _{constructor(t){Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mapInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=f(t,{el:null,drawType:"point",mapOptions:{center:[29.568,106.54241],zoom:12,zoomControl:!1,doubleClickZoom:!1,attributionControl:!1},addTitleUrl:t=>{window.L.tileLayer("https://gac-geo.googlecnapps.cn/maps/vt?lyrs=y&x={x}&y={y}&z={z}").addTo(t)},crs:"wgs84",pointOptions:{muti:!1}}),this.init().then((()=>{}))}async init(){switch(await this.importScriptAndStyle().catch((()=>{})),this.initMap(),this.createCssTextAndImport(),this.options.drawType){case"point":new m({map:this.mapInstance,...this.options.pointOptions,crs:this.options.crs,onError:(t,e)=>{this.options.onError?.(t,e)},onChange:t=>{this.options.onChange?.(t)}});break;case"polygon":new S({map:this.mapInstance,...this.options.drawOptions,crs:this.options.crs,onChange:t=>{this.options.onChange?.(t)},onError:(t,e)=>{this.options.onError?.(t,e)}})}}initMap(){this.mapInstance=window.L.map(this.options.el,this.options.mapOptions),this.options.addTitleUrl?.(this.mapInstance),this.options.onMapLoad?.(this.mapInstance,window.L)}importScriptAndStyle(){let t=d(["https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"],"L",(()=>void 0!==window.L)),e=function(t,e,n){return new Promise((async(n,r)=>{if("string"==typeof t)o(t).then((()=>{n(!0)})).catch((()=>{r("样式文件加载失败!,地址链接:"+t)}));else{for(const n of t){if(e&&e())break;await o(n)}e&&e()?n(!0):r("样式文件加载失败!,地址链接:"+t.join(","))}}));function o(t){return new Promise(((e,o)=>{let r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=t,r.dataset[n]=1,document.head.appendChild(r),r.onload=function(){e(!0)},r.onerror=function(t){o(t)}}))}}(["https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"],(()=>!!document.querySelector("link[data--l]")),"L");return new Promise(((n,o)=>{Promise.all([t,e]).then((()=>{n(!0)})).catch((t=>{o(t)}))}))}createCssTextAndImport(){if("1"===getComputedStyle(document.documentElement).getPropertyValue("--leaflet-draw-toolbox"))return;let t=document.createElement("style");t.type="text/css",t.innerHTML='\n    :root{\n      --leaflet-draw-toolbox:1;\n    }\n    .leaflet-control-clegend {\n      display:flex;\n      background-color:white;\n      padding: 0 5px;\n      border-radius: 5px;\n    }\n    .leaflet-control-clegend > div {\n      margin: 0 5px;\n      cursor:pointer;\n      padding: 10px 5px;\n      transition: all 0.2s;\n    }\n    .leaflet-control-clegend > div:hover {\n      color:green;\n    }\n    .leaflet-control-clegend > div.active {\n      color:green;\n    }\n    .polygon_icon > div {\n      width: 12px;\n      height:12px;\n      background:white;\n      border-radius:50%;\n      position:relative;\n    }\n    .polygon_icon > div:hover {\n      transform:scale(1.2);\n    }\n    .polygon_icon > div:before {\n      width: 4px;\n      height:4px;\n      background:#ffa502;\n      content: "";\n      position:absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      border-radius:50%;\n    }\n    \n    ',document.head.appendChild(t)}}export{_ as default};
